Dialog Python Bot SDK
=====================

Python Bot SDK for Dialog_ messenger.

.. _Dialog: https://dlg.im

**Bot SDK reference** covers the content of ``dialog_bot_sdk`` module, which is provided for bot development.

``dialog_api`` module is *protoc*-generated Python API over the Dialog API Schema, so **Dialog gRPC API Schema Reference** is auto-generated by ``sphinx-apidoc``.

Full documentation of **Dialog API Schema** is available here_.

.. _here: https://dialogs.github.io/api-schema/

Install
```````
* Firstly, you should download package:

.. code-block:: bash

    $ git clone https://github.com/dialogs/python-bot-sdk.git

* Next step is to install python packages (run command from python-bot-sdk folder):

.. code-block:: bash

    $ pip install -r requirements.txt

.. note::
    If you need to install SDK into restricted domain network where you have no
    direct access to PyPI or other python package repositories,
    you can try to provide name of one or more public package
    indexes via ``--trusted-host`` flag like this:

    .. code-block:: bash

        $ pip install --trusted-host pypi.org --trusted-host files.pythonhosted.org -r requirements.txt

* Finally, you need to obtain bot token. Type ``Security Bot`` in search bar of your Dialog and start conversation with them. Notice that `nickname` is unique system name while `name` is displayed in dialog list and can be non-unique.


Usage
`````

Simple echobot example:

.. code-block:: python

    from dialog_bot_sdk.bot import DialogBot
    import grpc
    import os


    def on_msg(*params):
        print('on msg', params)
        d.messaging.send_message(
            params[0].peer, str(params[0].message.textMessage.text)
        )


    if __name__ == '__main__':
        d = DialogBot.get_secure_bot(
            'grpc-test.transmit.im:8080',  # bot endpoint
            grpc.ssl_channel_credentials(),  # SSL credentials
            os.environ.get('BOT_TOKEN')  # bot token
        )

        d.messaging.on_message(on_msg)

Instantiating of Dialog Bot (secure):

.. code-block:: python

    d = DialogBot.get_secure_bot(
            'grpc-test.transmit.im:8080',  # bot endpoint
            grpc.ssl_channel_credentials(),  # SSL credentials
            os.environ.get('BOT_TOKEN')  # bot token
        )

Instantiating of Dialog Bot (insecure):

.. code-block:: python

    d = DialogBot.get_insecure_bot(
            'grpc-test.transmit.im:8080',  # bot endpoint
            os.environ.get('BOT_TOKEN')  # bot token
        )

Subscribing on messages:

.. code-block:: python

    d.messaging.on_message(on_msg)

Message reaction callback:

.. code-block:: python

    def on_msg(*params):
            print('on msg', params)
            d.messaging.send_message(
                params[0].peer, str(params[0].message.textMessage.text)
            )

Sending files:

.. code-block:: python

    d.messaging.send_file(params[0].peer, 'file.txt')

Sending images (not as files):

.. code-block:: python

    d.messaging.send_image(params[0].peer, 'image.png')
